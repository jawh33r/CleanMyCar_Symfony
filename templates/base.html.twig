<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}CleanMyCar{% endblock %}</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text><text y=%221.3em%22 x=%220.2em%22 font-size=%2276%22 fill=%22%23fff%22>sf</text></svg>">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    {% block stylesheets %}{% endblock %}
</head>
<body class="bg-light">
    {% include 'components/navbar.html.twig' %}
    
    <main class="container my-4">
        {% block body %}{% endblock %}
    </main>
    
    <footer class="bg-dark text-light py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>CleanMyCar</h5>
                    <p class="mb-0">Car cleaning service management system</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">&copy; {{ "now"|date("Y") }} CleanMyCar. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>
    
    {# Bootstrap JS Bundle #}
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // Manual dropdown handler that works independently of Bootstrap's initialization
        (function() {
            function handleDropdownClick(e) {
                var toggle = e.target.closest('.dropdown-toggle');
                if (!toggle) return;
                
                e.preventDefault();
                e.stopPropagation();
                
                var dropdown = toggle.closest('.dropdown');
                if (!dropdown) return;
                
                var menu = dropdown.querySelector('.dropdown-menu');
                if (!menu) return;
                
                var isOpen = menu.classList.contains('show');
                
                // Close all other dropdowns
                document.querySelectorAll('.dropdown-menu.show').forEach(function(m) {
                    if (m !== menu) {
                        m.classList.remove('show');
                        var t = m.closest('.dropdown')?.querySelector('.dropdown-toggle');
                        if (t) {
                            t.classList.remove('show');
                            t.setAttribute('aria-expanded', 'false');
                        }
                    }
                });
                
                // Toggle current dropdown
                if (isOpen) {
                    menu.classList.remove('show');
                    toggle.classList.remove('show');
                    toggle.setAttribute('aria-expanded', 'false');
                } else {
                    menu.classList.add('show');
                    toggle.classList.add('show');
                    toggle.setAttribute('aria-expanded', 'true');
                }
            }
            
            function handleDocumentClick(e) {
                var clickedDropdown = e.target.closest('.dropdown');
                if (!clickedDropdown) {
                    // Clicked outside, close all dropdowns
                    document.querySelectorAll('.dropdown-menu.show').forEach(function(menu) {
                        menu.classList.remove('show');
                        var toggle = menu.closest('.dropdown')?.querySelector('.dropdown-toggle');
                        if (toggle) {
                            toggle.classList.remove('show');
                            toggle.setAttribute('aria-expanded', 'false');
                        }
                    });
                }
            }
            
            // Initialize on page load
            function init() {
                // Remove Bootstrap's data-bs-toggle to prevent conflicts
                document.querySelectorAll('.dropdown-toggle').forEach(function(toggle) {
                    toggle.removeAttribute('data-bs-toggle');
                    toggle.addEventListener('click', handleDropdownClick);
                });
                
                // Close dropdowns when clicking outside
                document.addEventListener('click', handleDocumentClick);
            }
            
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>

    {% block javascripts %}
        {% block importmap %}{{ importmap('app') }}{% endblock %}
    {% endblock %}
</body>
</html>
